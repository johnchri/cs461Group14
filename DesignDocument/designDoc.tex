%Copyright 2014 Jean-Philippe Eisenbarth
%This program is free software: you can
%redistribute it and/or modify it under the terms of the GNU General Public
%License as published by the Free Software Foundation, either version 3 of the
%License, or {at your option} any later version.
%This program is distributed in the hope that it will be useful,but WITHOUT ANY
%WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
%PARTICULAR PURPOSE. See the GNU General Public License for more details.
%You should have received a copy of the GNU General Public License along with
%this program.  If not, see <http://www.gnu.org/licenses/>.

%Based on the code of Yiannis Lazarides
%http://tex.stackexchange.com/questions/42602/software-requirements-specification-with-latex
%http://tex.stackexchange.com/users/963/yiannis-lazarides
%Also based on the template of Karl E. Wiegers
%http://www.se.rit.edu/~emad/teaching/slides/srs_template_sep14.pdf
%http://karlwiegers.com
%\documentclass[letterpaper,10pt]{article}
\documentclass{scrreprt}
\usepackage{listings}
\usepackage{underscore}
\usepackage[bookmarks=true]{hyperref}
\usepackage[utf8]{inputenc}
\usepackage[english]{babel}
\usepackage{graphicx}
\usepackage{amssymb}
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{afterpage}

\usepackage{alltt}
\usepackage{float}
\usepackage{color}
\usepackage{url}

\usepackage{enumitem}

\usepackage{geometry}

\usepackage{titling}
\usepackage{rotating}
\usepackage{pgfgantt}
\usepackage{graphicx}
\usepackage{xcolor}
\usepackage{anyfontsize}

\ganttset{group/.append style={orange},
milestone/.append style={red},
progress label node anchor/.append style={text=red}}

\newcommand\blankpage{
    \null
    \thispagestyle{empty}
    \addtocounter{page}{0}
    \newpage}

\geometry{textheight=8.5in, textwidth=6in}
\hypersetup{
    bookmarks=false,    % show bookmarks bar?
    pdftitle={Software Requirement Specification},    % title
    pdfauthor={Jean-Philippe Eisenbarth},                     % author
    pdfsubject={TeX and LaTeX},                        % subject of the document
    pdfkeywords={TeX, LaTeX, graphics, images}, % list of keywords
    colorlinks=true,       % false: boxed links; true: colored links
    linkcolor=blue,       % color of internal links
    citecolor=black,       % color of links to bibliography
    filecolor=black,        % color of file links
    urlcolor=purple,        % color of external links
    linktoc=page            % only page is linked
}%
\def\myversion{1.0 }
\date{}
%\title{%

%}
\usepackage{hyperref}
\begin{document}

\begin{titlingpage}
	\begin{flushright}
		\rule{16cm}{5pt}\vskip1cm
		\begin{bfseries}
			\Huge{Design Document}\\
			\vspace{1.0cm}
			Deep Learning on Embedded Platform\\
			\vspace{1.0cm}
			\LARGE{Version \myversion}\\
			\vspace{1.0cm}
			Prepared by Christopher Johnson, Luay Alshawi, Gabe Morey\\
			\vspace{1.0cm}
			CS 461 Fall 2016\\
			\vspace{1.0cm}
			\today\\
		\end{bfseries}
	\end{flushright}
	\begin{abstract}
	In this document we describe the design of a deep learning system developed to learn how to play the arcade game Galaga.
	Galaga is an arcade shooter which was released in 1981 by Namco [1].
	This system is designed with the ultimate goal of being turned into a course for the NVIDIA Deep Learning Institute.
	The documentation will outline exactly what hardware was used, how the system was put together, and what methods were used in a way that allows others to recreate this project.
	\end{abstract}
\end{titlingpage}
\afterpage{\blankpage}

\tableofcontents

\chapter{Overview}

\section{Purpose}

The main aim of this document is to give others a thorough enough understanding of the project and its design.
The reader of this document should walk away able to understand how the system works and why it was designed this way.
The document must be thorough enough for NVIDIA to recreate the project and package the design into a training course on deep learning.
\newline

This project is to be used to produce a training course for NVIDIA's Deep Learning Institute.
After the project is complete it will be handed off to NVIDIA for the purposes of accomplishing this goal.
To that end the documentation has been designed to provide readers a clear path towards building this system themselves.

\section{Scope}

This document outlines the design of a system for teaching a deep learning neural network how to play the game Galaga.
The sections of this document will outline the system details, setup, and all things necessary to understand how and why the project is designed.
Hardware required, API's used, and setup will be detailed as part of the project design.

\section{Context}

This system is not designed for an average computer user.
This system is a showcase of possibilities when working with Neural Networks.
As such, no real UI has been developed for the purposes of this project.
Average people may see the result of the project by viewing the network play Galaga.
\newline

This system is designed for developers.
Developers should be able to do a project like this as an introduction to deep learning neural networks.
The documentation provided here reflects this focus and is written with developers in mind.

\section{Summary}

The neural network created for this project will be able to play Galaga.
Its design is based on GoogLeNet, a convolutional neural network designed in coordination by people at Google Inc.,  University of North Carolina, Chapel Hill, University of Michigan, Ann Arbor, and Magic Leap Inc. [2].
This neural network will undergo two main phases of training. One with just images, and a second hooked up to the game Galaga.
The system will run inference on the Jetson TX1 developer kit, which will interface between a computer playing the game with a controller.
Cloud computing GPUs will be used to handle the meat of the training.
In total, the system should be able to learn how to play Galaga, and then continually improve as it plays.

\chapter{References}

[1] F. Rojas, "Galaga (Namco)," in gaminghistory101.com, Gaming History 101, 2012. [Online]. Available: https://gaminghistory101.com/2012/03/22/galaga/.\newline
[2] C. Szegedy et al., "Going Deeper with Convolutions," in cs.unc.edu. [Online]. Available: https://www.cs.unc.edu/~wliu/papers/GoogLeNet.pdf.\newline

\chapter{Definitions}
\begin{description}

  \item[3.1 Neural Network:] A multilayered graph structure containing nodes, referred to as neurons, and weights that affect how likely the node is to be chosen when confronted with a decision.
The weights of nodes are decided through training the network, and a traversal of the graph acts as a large chain of decisions as the neural network is confronted with situations.

  \item[3.2 Deep Learning:]  Using a layered neural network constructed by GPU processing to teach a computer how to accomplish a specific task.

  \item[3.3 Convolutional Neural Network:] A neural network specifically designed to take images as input.
It uses convolutional layers to process the image into a more manageable chunk of data and extracts the information relevant to the network.

  \item[3.4 Caffe:] A code framework that allows for complex mathematical operations that are required for training a neural network.

  \item[3.5 API:] Application Programming Interface

  \item[3.6 Jetson TX1:] Quad core embedded system designed for power efficiency and deep learning projects

  \item[3.7 OS:] Operating system

  \item[3.8 OpenCV:] (Open Source Computer Vision) is a library that can be used with different languages(C, C++, Java, Python, etc.). It provides standard functionalities such as image capture, Faces recognition, Gesture recognition, Motion tracking, Mobile robotics, Object identification and Image manipulation.

  \item[3.9 Galaga:] Galaga is an arcade video game released in 1981 by Namco [1]. The player takes control of a small space ship and must shoot at and dodge waves of alien space ships.
Victory in a level is achieved by destroying all enemy ships.

\end{description}

\chapter{Design}

\section{Introduction}

This section lays out several viewpoints from which we have approached the design of this project.
Each component will be matched under an appropriate viewpoint that gives the reader a clear idea of how the design was apparoached.
Each subsection details a different set of components, many of which will be lumped together, which constitute a major piece of the final design.
There are three main viewpoints from which we have approached the design:
\begin{itemize}
  \item Structure Viewpoint: Design elements approached from a structural level.

  \item Information Viewpoint: Design elements approached from a perspective of data flow operations and data processing.

  \item Interaction Wiewpoint: Design elements relevant to getting systems to integrate with each other. Particularly focused on hardware setups required for the rest of the process.
\end{itemize}

Each viewpoint is covered in more depth in its respective section.

\section{Structure viewpoint}%Gabe

This section covers integral structural elements of the system and how they come together.
Tools used will be covered to give readers an idea of how we set up the system structure.
The heart of this structure is our neural network set-up.

\subsection{Neural network setup}%Gabe

The neural network set-up itself is a multi-layered combination of components.
At the basic level of design, our neural network follows the architecture known as GoogLeNet.
GoogLeNet is designed, as a convolutional neural network, specifically to process images and categorize them.
At the architectural level it has 22 layers, each consisting of special modules [2].
These modules have a structure similar to that outlined in figure \ref{fig:4.1}.

\begin{figure}
  \includegraphics[natwidth=100,natheight=85]{GoogLeNetModule.png}
  \caption{GoogLeNet Module}
  \label{fig:4.1}
\end{figure}

The network set-up provided by GoogLeNet needs to be accessed with a framework, as well as modified slightly for this project's needs.
For the framework this project uses Caffe.
Caffe allows for command line instructions to be sent to define the network.
To set up the network and Caffe properly we are using a program called DIGITS.
DIGITS is a neural network set-up application designed and released by NVIDIA.
It gives an easy interface for setting up the exact parameters for learning as well as building the network up.
The exact parameters we need for the set-up of this net are unknown at this time and will be added when available.
\newline

Training of the neural network will be done on NVIDIA GPUs on the Amazon Web Services cloud.
The network will run its calculations on the cloud and send its response down to the Jetson TX1.
There the response will be interpreted into the proper action.
\newline

The structural goal of the neural net changes between two stages.
In the first stage, the structure of the neural net is meant purely to teach it how to recognize and categorize in game objects from images.
In the second stage, the neural network will be deployed on the Jetson TX1 and will take active game information.
It will use that information to make one of three choices: move left, move right, or shoot.
More detail on the training will be given in section \ref{sssec:num2}.

\section{Information viewpoint}\label{sssec:num2}%Luay

The data in this section consists of image processing of the game being played as well as the data of the trained neural network.
This section will go in depth of both how image processing will be done as well as different ways to train and improve the neural network.
A pseudocode will be included to give an overview of where these data will be used in this project.
Also, the pseudocode \ref{fig:3.2} will include a general algorithm of how the Jetson will be able to play the game Galaga using the image capture data and the neural network.

\subsection{Set up image dataset}%Luay

OpenCV is a useful tool for this deep learning project.
It will be used as a helper tool to prepare the images for each object in the game such as players, enemies, and bullets.
A script will be written in python which will use an OpenCV to crop, resize, and filter the game images when needed.
The goal is to have a full set of the game images and their labels which will be used to train the neural network.
However, using OpenCV at this phase is optional, but due to the need of fast image manipulation, OpenCV can be used to do this task easily as it will help to save time and efforts.
Although, collecting objects’ images can be done manually, eventually, OpenCV will be used to resize the collected images to a consistent size.

\subsection{Image processing}%Luay

After having a trained neural network, a software written in python will start by loading the necessary dependencies which are OpenCV, Caffe, and the trained neural network.
At this step, it’s important to convert the given neural network to an object that OpenCV can understand.
Then, a video capture of the game will take a place to record the monitor where the game is being played using OpenCV's API
\footnote{The hardware connection of the camera as well as the control mechanism of the game shall be explained in section \ref{sssec:num1}.}.
Since videos are just consecutive of images, OpenCV will be used to process the images by comparing them with the trained neural network.
The idea is to identify the location of each dangerous objects that would reduce the player's life so the Jetson TX1 can send a command to the game controller which moves the player away from the harmful object.



\subsection{Neural training methods}%Gabe

The training of the neural network will be done in two stages.
In the first stage, we will be using images created from the game to teach the network how to recognize in game objects.
Given that GoogLeNet was designed with image categorization in mind, this set-up will be easy to create and bring to functionality.
We will feed the network with images doctored by OpenCV and it will interpret them and label them.
Once it has a high degree of success in correctly identifying in game objects, we will take the training to stage two.
\newline

In the second stage of training we will be feeding the network images directly from live game progress.
The game will be running and the network will be deployed on the Jetson.
The network will be given the ability to take actions based on the objects it identifies on screen.
Positive feedback will be given to the neural network when it correctly kills an enemy or completes a level.
Negative feedback will be given to the network when it dies, gets a game over, or loops too long doing nothing.
As the neural network plays the game, it will improve performance and eventually be considered proficient.

\subsection{Data visualization}%Chris

We also needed to figure out how we were going to display the results of each round.
We decided it would be best to have a summary graphical display of the data at the end of the playthrough.
Once the program runs out of lives a screen will appear graphing statistics about the machines performance.
These statistics will include things such as how long the machine lasted, how many levels it completed, which enemies or objects took away the most lives, and so on.
Having detailed and easily readable data is key to knowing how to train the machine to keep performing better in the game.

\subsection{Pseudocode}
\begin{figure}
  \includegraphics[natwidth=100,natheight=120]{pseudocode.png}
  \caption{Software Design to Play the Game}
  \label{fig:3.2}
\end{figure}

\newpage

\section{Interaction Viewpoint}\label{sssec:num1}%Chris

This section details how our physical hardware components interact to form a cohesive system.
It will outline several pieces of hardware used to realize the goal of playing galaga.

\subsection{Hardware setup}%Chris

While working with the Jetson TX1 there are several things that we needed to decide.
These included our methods to communicate with our client, and the hardware used with the Jetson.
Choosing out hardware was key to determining how each piece would fit into the design.
\newline

Our project will actually need to be able to control the game.
Inputs from the neural net need to be received by the game so that it can be played.
To do this we decided not to use the standard keyboard.
Using a keyboard requires a lot of additional coding to map the Jetson to the controls.
Instead we decided to find a game controller that we will hardwire to the Jetson TX1.
A game controller will significantly reduce the work load because it will already contain a lot of built in functionality that we need to connect it to the Jetson.
The Jetson will be able to control the game using the controller's built in functionality.

\begin{figure}
  \includegraphics[natwidth=100,natheight=200]{design.JPG}
  \caption{Hardware Layout}
  \label{fig:4.3}
\end{figure}
Figure \ref{fig:4.3} shows the basic layout.

Since the Jetson has to learn how to play the game it needs to be able to see the game.
For this we decided to use the camera sent to us by our client.
This was the simplest option seeing as we can connect the camera directly to the Jetson.
The camera will be connected to the Jetson and aimed at the screen showing the programs gameplay.
The program will first be trained by being given the video input to recognize and characterize objects within the game.
We will set up tables so that the neural net will be able to store information such as the locations of objects.
Once those things are set up it will be able to train itself by playing the game using the controller.
It will base its decisions on the table of information that it stores and will increasingly be able to survive the game longer.
Eventually it will learn to respond to certain patterns in the table in order to become better at the game.

\chapter{Conclusion}
The goal of this design document is to provide the "how to" of this deep learning project which will be turned to the NVIDIA's deep learning institute to use it in a deep learning course.
The overall steps for this document are to teach the Jetson TX1 to play the game Galaga by training a neural network to identify game objects to become effectively able to move the player away from enemies.
This can be done based on three major phases which are preparing images for the game objects, train neural network based on the set of images and label them, and finally by using a camera connected to the Jetson TX1 while the game hosted on a different machine that is being controlled using the Jetson TX1.

\end{document}
